# 配置检查

本文档提供了一系列帮助验证 Klipper printer.cfg 文件中的引脚设置的步骤。推荐在完成[安装文档](Installation.md) 中的步骤后执行本文档中的步骤。

在执行此指南的过程中，可能需要修改 Klipper 的配置文件。请务必在每次修改配置文件后发送 RESTART 命令，以确保修改成功生效（在 Octoprint 终端标签中输入 "RESTART"（重启），然后点击 "Send"（发送））。在每次重启之后最好再发出一次 STATUS （状态）命令，以验证配置文件是否成功加载。

## 验证温度

首先验证温度是否被正确的报告。导航到 Octoprint 温度选项卡。

![octoprint-温度](img/octoprint-temperature.png)

确认喷嘴和热床（如果适用）的温度合理且不在上升。如果温度正在上升，请立即断开打印机的电源。如果温度显示不准确，请检查热端和/或热床的 “sensor_type” 和 “sensor_pin” 设置。

## 验证 M112

导航到 Octoprint 终端选项卡并通过终端发送 M112 命令。该命令会使 Klipper 进入关闭状态，并导致 Octoprint 与 Klipper 断开链接。找到连接板块单击 "Connect"（连接）以重新连接到 Klipper。然后在 Octoprint 温度选项卡中验证温度是否持续更新和升高。如果温度升高，请立即断开打印机电源。

M112 命令会使 Klipper 进入 "shutdown"（关闭）状态。要退出这一状态，请在 Octoprint 终端选项卡中发出 FIRMWARE_RESTART 命令。

## 验证加热器

导航到 Octoprint 温度选项卡中的“Tool”（工具）温度框，输入 50 并按下回车。 图中的挤出头温度应开始升高（在约 30 秒左右的时间内）。 然后在工具温度的下拉框中选择“off”（关闭）。 几分钟后，温度应开始恢复到其初始室温值。 如果温度没有上升，需要检查配置中的“heater_pin”设置是否正确。

如果打印机带有热床，则用热床重复上述测试。

## 验证步进电机 enable（启用）引脚

验证所有打印机轴都可以用手自由移动（步进电机已禁用）。 如果没有，请发出 M84 命令禁用电机。 如果任何轴仍然无法自由移动，需要检查该轴的步进驱动“enable_pin”（使能引脚）配置。 在大多数步进电机驱动器上，电机使能引脚为“低电平有效”，因此使能引脚在pin之前应带有“！” （例如，“enable_pin: !ar38”）。

## 验证限位开关

手动移动所有打印机轴，使它们都不与限位器接触。 通过 Octoprint 终端发送 QUERY_ENDSTOPS 命令。 它应该以所有配置的限位的当前状态做出响应，并且它们都应该报告“open”（未触发）状态。 手动触发每个限位器的同时重新运行 QUERY_ENDSTOPS 命令。相应的限位应该被 QUERY_ENDSTOPS 报告为“TRIGGERED”。

如果限位状态是相反的（触发时报告“open”，反之亦然），则添加“！” 到引脚定义（例如，“endstop_pin: ^!ar3”），如果存在“！”就将之删除。

如果限位状态根本没有变化，则通常表示限位器连接到不同的引脚。 但是，它也可能表示需要更改引脚的上拉设置（endstop_pin 名称开头的“^” - 大多数打印机需要使用上拉电阻并且应该存在“^”）。

## 验证步进电机

使用 STEPPER_BUZZ 命令验证每个步进电机的连通性。 首先将要验证的轴手动挪到到中间点，然后运行`STEPPER_BUZZ STEPPER=stepper_x`。 STEPPER_BUZZ 命令将使X轴向正方向移动一毫米，再返回到其起始位置。 （如果在 position_endstop=0 处定义了限位的位置，则在每次运动开始时，步进器将远离限位。）它将执行这个动作十次。

如果步进电机根本不动，则需要验证步进驱动的“enable_pin”和“step_pin”设置。 如果步进电机移动但没有返回其原始位置，则需要验证“dir_pin”设置。 如果步进电机的振荡方向不正确，则通常表示需要反转驱动的“dir_pin”。 即通过添加“!” 到打印机配置文件中的“dir_pin”设置来完成（如果已经存在"!"，则将其删除）。 如果电机移动明显大于或小于一毫米，则需要验证“rotation_distance”设置。

对配置文件中定义的每个步进电机运行上述测试。 （将 STEPPER_BUZZ 命令的 STEPPER 参数设置为要测试的配置部分的名称。）如果挤出机中没有耗材，也可以使用 STEPPER_BUZZ 验证挤出机电机的接线（使用 STEPPER=extruder）。 否则，最好单独测试挤出机电机（参见下一节）。

在验证完所有限位器和所有步进电机后，应测试归位机制。 发出 G28 命令以归位所有轴。 如果打印机不能正常归位，请断开打印机电源。 然后，重新执行限位器和步进电机验证流程。

## 验证挤出机电机

要测试挤出机电机，必须先将热端加热到打印温度。导航到 Octoprint 温度选项卡并在温度下拉框中选择目标温度（或手动输入适当的温度）。等待打印机达到目标温度，然后找到 Octoprint 控制选项卡并单击“Extrude”（挤出）按钮。 确认挤出机电机以正确的方向转动。 如果没有，请参阅上一节中的故障排除提示，以确认挤出机的“enable_pin”、“step_pin”和“dir_pin”设置。

## 校准 PID 设置

Klipper支持挤出机和热床加热器的[PID控制](https://en.wikipedia.org/wiki/PID_controller)。为了使用这种控制机制，必须对每台打印机的 PID 参数进行校准（在其他固件或示例配置文件中找到的 PID 设置往往效果不佳）。

要校准挤出机，请找到 OctoPrint 终端选项卡并运行 PID_CALIBRATE 命令。 例如：`PID_CALIBRATE HEATER=extruder TARGET=170`

调整测试完成后，运行 `SAVE_CONFIG` 以保存新PID设置到printer.cfg文件。

如果打印机有加热床，并且支持PWM（脉宽调制）驱动，那么建议对加热床使用PID控制。 （当使用 PID 算法控制床加热器时，它可能每秒打开和关闭十次，这可能不适用于使用机械开关的加热器。）一般的热床 PID 校准命令是：`PID_CALIBRATE HEATER=heater_bed TARGET= 60`

## 下一步

本指南旨在帮助对 Klipper 配置文件中的引脚设置进行基本验证。 请务必阅读 [床位调平](Bed_Level.md) 指南。 另请参阅 [切片软件](Slicers.md) 文档，了解有关使用 Klipper 配置切片软件的信息。

在验证基本打印工作后，最好考虑校准 [压力提前](Pressure_Advance.md)。

可能需要执行其他类型的详细打印机校准 - 网络上提供了许多指南来帮助解决此问题（例如，在网络上搜索“3d 打印机校准”）。 例如，如果您遇到称为振铃的效果，您可以尝试遵循 [共振补偿](Resonance_Compensation.md) 调谐指南。
