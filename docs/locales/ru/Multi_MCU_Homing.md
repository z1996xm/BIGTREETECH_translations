# Самонаведение и зондирование с несколькими микроконтроллерами

Klipper поддерживает механизм самонаведения с концевым упором, подключенным к одному микроконтроллеру, в то время как его шаговые двигатели подключены к другому микроконтроллеру. Эта поддержка называется "самонаведением с несколькими микроконтроллерами". Эта функция также используется, когда Z-зонд находится на другом микроконтроллере, чем Z-шаговые двигатели.

Эта функция может быть полезна для упрощения подключения, так как может быть удобнее присоединить концевой упор или зонд к более близкому микроконтроллеру. Однако использование этой функции может привести к "перерегулированию" шаговых двигателей во время операций наведения и зондирования.

Превышение происходит из-за возможных задержек передачи сообщений между микроконтроллером, контролирующим конечный упор, и микроконтроллерами, приводящими в движение шаговые двигатели. Код Клиппера предназначен для ограничения этой задержки не более чем на 25 мс. (Когда активировано самонаведение с несколькими микроконтроллерами, микроконтроллеры периодически отправляют сообщения о состоянии и проверяют, что соответствующие сообщения о состоянии получены в течение 25 мс.)

Так, например, при наведении со скоростью 10 мм/с возможно превышение до 0,250 мм (10 мм/с * .025s == 0,250 мм). При конфигурировании наведения с несколькими модулями необходимо учитывать этот тип проскакивания. Использование более медленных скоростей наведения или зондирования может уменьшить перерегулирование.

Перерегулирование шагового двигателя не должно отрицательно влиять на точность процедуры наведения и зондирования. Код Klipper обнаружит проскакивание и учтет его в своих расчетах. Однако важно, чтобы аппаратная конструкция была способна справиться с перерегулированием без повреждения машины.

Если Klipper обнаружит проблему связи между микроконтроллерами во время наведения нескольких мку, он выдаст ошибку "Communication timeout during homing".

Обратите внимание, что ось с несколькими степперами (например, `stepper_z` и `stepper_z1`) должна быть на одном микроконтроллере, чтобы использовать мульти-mcu homing. Например, если концевой упор находится на отдельном микроконтроллере от `stepper_z`, то `stepper_z1` должен быть на том же микроконтроллере, что и `stepper_z`.
