# Проверки конфигурации

В этом документе приведен список действий, которые помогут подтвердить настройки выводов (pin) в файле Klipper printer.cfg. Рекомендуется выполнить эти шаги после выполнения шагов, описанных в [документе по установке](Installation.md).

Во время работы с этим руководством может потребоваться внести изменения в конфигурационный файл Klipper. Обязательно выполняйте команду RESTART после каждого изменения в файле конфигурации, чтобы убедиться, что изменение вступило в силу (введите «restart» на вкладке терминала Octoprint, а затем нажмите «Отправить»). Также рекомендуется запускать команду STATUS после каждого RESTART, чтобы убедиться, что файл конфигурации успешно загружен.

## Проверьте температуру

Начните с проверки правильности регистрации температуры. Перейдите на вкладку температуры Octoprint.

![octoprint-temperature](img/octoprint-temperature.png)

Убедитесь, что температура сопла и стола (если применимо) присутствует и не повышается. Если он увеличивается, отключите питание принтера. Если температуры неточны, проверьте настройки «sensor_type» и «sensor_pin» для сопла и/или стола.

## Проверьте M112

Перейдите на вкладку терминала Octoprint и введите команду M112 в терминале. Эта команда требует от Klipper перейти в состояние «выключения». Это приведет к отключению Octoprint от Klipper — перейдите в область «Подключение» и нажмите «Подключиться», чтобы вызвать повторное подключение Octoprint. Затем перейдите на вкладку температуры Octoprint и убедитесь, что температура продолжает обновляться и не повышается. Если температура повышается, отключите питание принтера.

Команда M112 переводит Klipper в состояние «отключения». Чтобы сбросить это состояние, введите команду FIRMWARE_RESTART на вкладке терминала Octoprint.

## Проверка нагревателей

Перейдите на вкладку температуры Octoprint и введите 50, а затем введите в поле температуры «Инструмент». Температура экструдера на графике должна начать увеличиваться (примерно через 30 секунд). Затем перейдите в раскрывающийся список температуры «Инструмент» и выберите «Выкл.». Через несколько минут температура должна начать возвращаться к исходному значению комнатной температуры. Если температура не увеличивается, проверьте настройку «heater_pin» в конфигурации.

Если в принтере есть стол с подогревом, повторите вышеуказанный тест со столом.

## Проверьте пин включения шагового двигателя

Убедитесь, что все оси принтера могут свободно перемещаться вручную (шаговые двигатели отключены). Если нет, введите команду M84, чтобы отключить двигатели. Если какая-либо из осей по-прежнему не может свободно двигаться, проверьте конфигурацию шагового двигателя «enable_pin» для данной оси. В большинстве стандартных драйверов шаговых двигателей вывод включения двигателя имеет значение «active low», поэтому вывод включения должен иметь «!» перед выводом (например, «enable_pin: !ar38»).

## Проверьте концевые упоры

Вручную переместите все оси принтера так, чтобы ни одна из них не касалась упора. Отправьте команду QUERY_ENDSTOPS через вкладку терминала Octoprint. Он должен вернуть текущее состояние всех настроенных концевых упоров, и все они должны сообщать состояние «open». Для каждого упора повторно запустите команду QUERY_ENDSTOPS, одновременно активируя концевой упор. Команда QUERY_ENDSTOPS должна сообщать о концевом упоре как «TRIGGERED».

Если упор отображается противоположным (при срабатывании он сообщает «open» и наоборот), добавьте «!» к определению контакта (например, «endstop_pin: ^! ar3») или удалите «!», если он уже присутствует.

Если концевой упор вообще не меняется, это обычно указывает на то, что концевой упор подключен к другому контакту. Однако может также потребоваться изменение настройки подтягивания вывода (символ «^» в начале имени endstop_pin — в большинстве принтеров используется подтягивающий резистор, и символ «^» должен присутствовать).

## Проверка шаговых двигателей

Используйте команду STEPPER_BUZZ для проверки подключения каждого шагового двигателя. Начните с ручного позиционирования данной оси в средней точке, а затем запустите `STEPPER_BUZZ STEPPER=stepper_x`. Команда STEPPER_BUZZ заставит данный шаговый двигатель переместиться на один миллиметр в положительном направлении, а затем вернется в исходное положение. (Если конечная остановка определена как position_endstop=0, то в начале каждого движения шаговый двигатель будет удаляться от конечной остановки.) Это колебание будет выполняться десять раз.

Если шаговый двигатель вообще не двигается, проверьте настройки "enable_pin" и "step_pin" для шагового двигателя. Если шаговый двигатель перемещается, но не возвращается в исходное положение, проверьте настройку «dir_pin». Если шаговый двигатель колеблется в неправильном направлении, это обычно указывает на то, что «dir_pin» для оси необходимо инвертировать. Это делается путем добавления '!' в «dir_pin» в файле конфигурации принтера (или удалив его, если он уже есть). Если двигатель перемещается значительно больше или значительно меньше одного миллиметра, проверьте настройку «rotation_distance».

Запустите приведенный выше тест для каждого шагового двигателя, указанного в файле конфигурации. (Установите параметр STEPPER команды STEPPER_BUZZ на имя проверяемого раздела конфигурации.) Если в экструдере нет нити, можно использовать STEPPER_BUZZ для проверки подключения двигателя экструдера (используйте STEPPER=extruder). В противном случае лучше протестировать двигатель экструдера отдельно (см. следующий раздел).

После проверки всех концевых упоров и проверки всех шаговых двигателей следует проверить механизм возврата в исходное положение. Введите команду G28 для возврата всех осей в исходное положение. Отключите питание принтера, если он не возвращается в исходное положение должным образом. При необходимости повторите этапы проверки концевого упора и шагового двигателя.

## Проверка двигатель экструдера

Для проверки двигателя экструдера необходимо нагреть экструдер до температуры печати. Перейдите на вкладку «Температура Octoprint» и выберите целевую температуру в раскрывающемся списке температур (или введите соответствующую температуру вручную). Подождите, пока принтер не достигнет нужной температуры. Затем перейдите на вкладку управления Octoprint и нажмите кнопку «Выдавливание». Убедитесь, что двигатель экструдера вращается в правильном направлении. Если это не так, см. советы по устранению неполадок в предыдущем разделе, чтобы подтвердить настройки «enable_pin», «step_pin» и «dir_pin» для экструдера.

## Калибровка настроек PID

Klipper поддерживает [ПИД-регуляцию](https://ru.wikipedia.org/wiki/ПИД-регулятор) для экструдера и нагревателей. Чтобы использовать этот механизм управления, необходимо откалибровать настройки ПИД на каждом принтере (настройки ПИД, найденные в других прошивках или в образцах файлов конфигурации, часто работают плохо).

Чтобы откалибровать экструдер, перейдите на вкладку терминала OctoPrint и выполните команду PID_CALIBRATE. Например: `PID_CALIBRATE HEATER=eextruder TARGET=170`

По завершении тестовой настройки запустите `SAVE_CONFIG`, чтобы обновить файл print.cfg с новыми настройками PID.

Если в принтере есть стол с подогревом и он поддерживает управление с помощью PWM (широтно-импульсной модуляции), то рекомендуется использовать ПИД-регулятор для стола. (Когда нагреватель стола управляется с помощью алгоритма PID, он может включаться и выключаться десять раз в секунду, что может не подходить для нагревателей с механическим переключателем.) Типичная команда калибровки PID стола: `PID_CALIBRATE HEATER=heater_bed TARGET=60`

## Следующие шаги

Это руководство призвано помочь с базовой проверкой настроек контактов в файле конфигурации Klipper. Обязательно прочитайте руководство [bed leveling](Bed_Level.md). Также см. документ [Slicers](Slicers.md) для получения информации о настройке слайсера с помощью Klipper.

После того, как вы убедились, что основная печать работает, рекомендуется подумать о калибровке [повышения давления](Pressure_Advance.md).

Возможно, потребуется выполнить другие типы детальной калибровки принтера — чтобы помочь с этим, в Интернете доступен ряд руководств (например, выполните поиск в Интернете по запросу «калибровка 3D-принтера»). Например, если вы столкнулись с эффектом, называемый звоном, вы можете попробовать выполнить настройку по руководству [компенсации резонанса](Resonance_Compensation.md).
